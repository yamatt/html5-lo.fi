{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///./src/js/source/yt.js","webpack:///./src/js/index.js","webpack:///./src/js/static.js","webpack:///./src/js/background.js","webpack:///./src/js/player.js","webpack:///./src/js/shortcuts.js"],"sourcesContent":["const State = {\n  \"STOPPED\": 0,\n  \"PLAYING\": 1\n}\n\nexport default class YouTube {\n  #state;\n\n  constructor(player_el, stream_url) {\n    this.player_el = player_el;\n    this.stream_url = stream_url;\n  }\n\n  setup(){\n    let that = this;\n    let yt_iframe = document.createElement(\"iframe\");\n    yt_iframe.setAttribute(\"allow\", \"autoplay; encrypted-media;\");\n    yt_iframe.setAttribute(\"src\", this.stream_url + \"?enablejsapi=1\");\n    yt_iframe.addEventListener(\"load\", function (e) { that.play() })\n    this.player_el.appendChild(yt_iframe);\n    this.#state = State.STOPPED;\n  }\n\n  get state() {\n    return this.#state;\n  }\n\n  post_message(message) {\n    this.player_el.childNodes[0].contentWindow.postMessage('{\"event\":\"command\",\"func\":\"' + message + '\",\"args\":\"\"}', '*')\n  }\n\n  play() {\n    this.post_message('playVideo')\n    this.#state = State.PLAYING;\n  }\n\n  stop() {\n    this.post_message('stopVideo')\n    this.#state = State.STOPPED;\n  }\n\n  destroy() {\n    this.stop()\n    while (this.player_el.lastChild) {\n      this.player_el.removeChild(this.player_el.lastChild);\n    }\n    this.#state == undefined;\n  }\n}\n","import StaticPlayer from \"./static.js\";\n\nlet static_player;\n\n(function () {\n  static_player = new StaticPlayer();\n  static_player.run();\n})();\n","import Player from \"./player.js\";\nimport Background from \"./background.js\";\nimport Shortcuts from \"./shortcuts.js\";\n\nexport default class StaticPlayer {\n  BACKGROUND_VIDEO_EL_ID = \"background-video\"\n  BACKGROUND = Background;\n\n  PLAYER_EL_ID = \"player\";\n  PLAYER = Player;\n\n  SHORTCUTS = Shortcuts;\n\n  #background_video;\n  #background;\n  #player_el;\n  #player;\n  #shortcuts;\n\n\n  get background_video_el (){\n    if (!this.#background_video){\n      this.#background_video = document.getElementById(this.BACKGROUND_VIDEO_EL_ID);\n    }\n    return this.#background_video;\n  }\n\n  get background() {\n    if (!this.#background) {\n      this.#background = new this.BACKGROUND(this);\n    }\n    return this.#background;\n  }\n\n  get player_el (){\n    if (!this.#player_el) {\n      this.#player_el = document.getElementById(this.PLAYER_EL_ID);\n    }\n    return this.#player_el;\n  }\n\n  get player(){\n    if(!this.#player) {\n      this.#player = new this.PLAYER(this);\n    }\n    return this.#player;\n  }\n\n  get shortcuts() {\n    if (!this.#shortcuts) {\n      this.#shortcuts = new this.SHORTCUTS(this);\n    }\n    return this.#shortcuts;\n  }\n\n  run() {\n    this.shortcuts.setup();\n    this.player.start();\n    this.background.start();\n  }\n}\n","export default class BackgroundVideo {\n  BACKGROUND_VIDEO_URL = \"backgrounds.json\"\n\n  constructor (parent) {\n    this.parent = parent;\n    this.background_video_el = parent.background_video_el;\n    this.background_video_el.defaultPlaybackRate = 0.5;\n  }\n\n  get_json(url, callback) {\n    return fetch(url)\n      .then(function(response) {\n        if (!response.ok) {\n          throw new Error(\"HTTP error, status = \" + response.status);\n        }\n        return response.json();\n      })\n      .then(callback.bind(this))\n  }\n\n  handle_backgrounds(backgrounds) {\n    this.backgrounds = backgrounds;\n  }\n\n  random_choice(arr){\n    return arr[Math.floor(Math.random() * arr.length)];\n  }\n\n  random_background() {\n    return this.random_choice(this.backgrounds)\n  }\n\n  update_background (background) {\n    this.background_video_el.setAttribute(\"src\", background.url);\n  }\n\n  change() {\n    this.background = this.random_background()\n    this.update_background(this.background);\n    if (this.parent.player.stream) {\n      localStorage.setItem(\"bg-\" + this.parent.player.stream.id, this.background.id);\n    }\n  }\n\n  get_backgrounds() {\n    return this.get_json(this.BACKGROUND_VIDEO_URL, this.handle_backgrounds)\n  }\n\n  start() {\n    this.get_backgrounds()\n      .then(this.change.bind(this))\n  }\n}\n","import YouTube from \"./source/yt.js\"\n\nconst State = {\n  \"STOPPED\": 0,\n  \"PLAYING\": 1\n}\n\nexport default class Player {\n  STREAMS_URL = \"streams.json\"\n\n  SOURCES = {\n    \"www.youtube.com\": YouTube\n  }\n\n  constructor (parent) {\n    this.parent = parent\n    this.player_el = parent.player_el;\n  }\n\n  get_json(url, callback) {\n    return fetch(url)\n      .then(function(response) {\n        if (!response.ok) {\n          throw new Error(\"HTTP error, status = \" + response.status);\n        }\n        return response.json();\n      })\n  }\n\n  handle_streams(streams) {\n    this.streams = streams;\n  }\n\n  random_choice(arr){\n    return arr[Math.floor(Math.random() * arr.length)];\n  }\n\n  random_stream() {\n    return this.random_choice(this.streams);\n  }\n\n  change_stream () {\n    this.stream = this.random_stream();\n    if (this.source) {this.source.destroy()}\n\n    const stream_url = new URL(this.stream.url);\n    this.source = new this.SOURCES[stream_url.hostname](this.player_el, this.stream.url)\n    this.source.setup()\n    localStorage.setItem(\"stream\", this.stream.id);\n  }\n\n  pause() {\n    this.source.stop();\n  }\n\n  play() {\n    this.source.play();\n  }\n\n  toggle() {\n    if (this.source.state == State.PLAYING) {\n      this.source.stop();\n      return;\n    }\n    else if (this.source.state == State.STOPPED) {\n      this.source.play();\n      return;\n    }\n  }\n\n  clear(){\n    if (this.source) {this.source.destroy()};\n  }\n\n  start() {\n    this.get_json(this.STREAMS_URL, this.handle_streams)\n      .then(this.handle_streams.bind(this))\n      .then(this.change_stream.bind(this))\n      .then(this.play.bind(this))\n  }\n}\n","export default class Shortcuts {\n  KEY_MAP = {\n    \"Space\": this.space\n  }\n\n  constructor(parent) {\n    this.parent = parent;\n  }\n\n  setup() {\n    const that = this;\n    document.addEventListener(\"keypress\", (e) => {\n      e = e || window.event;\n\n      this.KEY_MAP[e.code].call(that, e)\n    })\n  }\n\n  space (e) {\n    this.parent.player.toggle();\n  }\n}\n"],"names":["YouTube","constructor","player_el","stream_url","this","setup","that","yt_iframe","document","createElement","setAttribute","addEventListener","e","play","appendChild","post_message","message","childNodes","contentWindow","postMessage","stop","destroy","lastChild","removeChild","static_player","BACKGROUND_VIDEO_EL_ID","BACKGROUND","BACKGROUND_VIDEO_URL","parent","background_video_el","defaultPlaybackRate","get_json","url","callback","fetch","then","response","ok","Error","status","json","bind","handle_backgrounds","backgrounds","random_choice","arr","Math","floor","random","length","random_background","update_background","background","change","player","stream","localStorage","setItem","id","get_backgrounds","start","PLAYER_EL_ID","PLAYER","STREAMS_URL","SOURCES","handle_streams","streams","random_stream","change_stream","source","URL","hostname","pause","toggle","state","clear","SHORTCUTS","KEY_MAP","space","window","event","code","call","getElementById","run","shortcuts"],"sourceRoot":""}