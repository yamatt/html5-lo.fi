{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///./src/js/source/yt.js","webpack:///./src/js/state.js","webpack:///./src/js/player.js","webpack:///./src/js/background.js","webpack:///./src/js/shortcuts.js","webpack:///./src/js/info.js","webpack:///./src/js/media.js","webpack:///./src/js/gestures.js","webpack:///./src/js/updater.js","webpack:///./src/js/storage.js","webpack:///./src/js/index.js","webpack:///./src/js/static.js"],"sourcesContent":["import { State } from '../state';\n\nexport default class YouTube {\n  #state;\n  #iframe;\n\n  constructor(parent) {\n    this.parent = parent;\n    this.player_el = parent.player_el;\n    this.stream_url = parent.stream.url;\n  }\n\n  setup(){\n    let that = this;\n    this.#iframe = document.createElement(\"iframe\");\n    this.#iframe.setAttribute(\"allow\", \"autoplay; encrypted-media;\");\n    this.#iframe.setAttribute(\"src\", this.stream_url + \"?enablejsapi=1\");\n    this.#iframe.addEventListener(\"load\", function (e) { that.play() })\n    this.player_el.appendChild(this.#iframe);\n    this.state = State.STOPPED;\n  }\n\n  get state() {\n    return this.#state;\n  }\n\n  set state (state) {\n    this.#state = state;\n  }\n\n  post_message(message) {\n    this.#iframe.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"' + message + '\",\"args\":\"\"}', '*')\n  }\n\n  play() {\n    this.post_message('playVideo')\n    this.state = State.PLAYING;\n  }\n\n  stop() {\n    this.post_message('stopVideo')\n    this.state = State.STOPPED;\n  }\n\n  destroy() {\n    this.stop()\n    this.#iframe.remove();\n    this.#iframe = undefined;\n    this.state == undefined;\n  }\n}\n","export const State = {\n  \"STOPPED\": 0,\n  \"PLAYING\": 1\n}\n","import YouTube from \"./source/yt.js\"\nimport { State } from './state';\n\nexport default class Player {\n  STREAMS_URL = \"streams.json\"\n\n  SOURCES = {\n    \"www.youtube.com\": YouTube\n  }\n\n  #streams;\n  #stream_index;\n\n  constructor (parent) {\n    this.parent = parent\n    this.player_el = parent.player_el;\n  }\n\n  get_json(url, callback) {\n    return fetch(url)\n      .then(function(response) {\n        if (!response.ok) {\n          throw new Error(\"HTTP error, status = \" + response.status);\n        }\n        return response.json();\n      })\n      .then(callback.bind(this))\n  }\n\n  set streams(streams) {\n    this.#streams = streams;\n\n    this.stream = this.parent.storage.stream_index;\n  }\n\n  get streams() {\n    return this.#streams;\n  }\n\n  set stream (index) {\n    if (index == null) {\n      index = this.random_stream_index(this.streams);\n    }\n\n    this.parent.storage.stream_index = index;\n    this.#stream_index = index;\n\n    this.start_stream();\n  }\n\n  get stream() {\n    return this.streams[this.#stream_index];\n  }\n\n  random_stream_index(arr){\n    return Math.floor(Math.random() * arr.length);\n  }\n\n  random_stream() {\n    var that = this;\n    let streams = Object.keys(this.streams).map(function (key) {\n      return that.streams[key];\n    });\n    return this.random_choice(streams);\n  }\n\n  change_stream (step) {\n    if(!step) {\n      step=1;\n    }\n\n    let next = this.#stream_index+step;\n    if (next > this.streams.length-1) {\n      next = 0;\n    }\n    this.stream = next;\n  }\n\n  start_stream() {\n    this.parent.info.update_stream(this.stream);\n\n    if (this.source) {this.source.destroy()}\n    const stream_url = new URL(this.stream.url);\n    this.source = new this.SOURCES[stream_url.hostname](this);\n    this.source.setup()\n  }\n\n  pause() {\n    this.source.stop();\n  }\n\n  play() {\n    this.source.play();\n  }\n\n  toggle() {\n    if (this.source.state == State.PLAYING) {\n      this.source.stop();\n      return;\n    }\n    else if (this.source.state == State.STOPPED) {\n      this.source.play();\n      return;\n    }\n  }\n\n  clear(){\n    if (this.source) {this.source.destroy()};\n  }\n\n  setup() {\n    let that = this;\n    this.get_json(this.STREAMS_URL, (streams) => {\n      that.streams = streams;\n    })\n  }\n}\n","export default class BackgroundVideo {\n  BACKGROUND_VIDEO_URL = \"backgrounds.json\"\n\n  #backgrounds;\n  #background_index;\n\n  constructor (parent) {\n    this.parent = parent;\n    this.background_video_el = parent.background_video_el;\n    this.background_video_el.defaultPlaybackRate = 0.5;\n  }\n\n  get_json(url, callback) {\n    return fetch(url)\n      .then(function(response) {\n        if (!response.ok) {\n          throw new Error(\"HTTP error, status = \" + response.status);\n        }\n        return response.json();\n      })\n      .then(callback.bind(this))\n  }\n\n  set backgrounds(backgrounds) {\n    this.#backgrounds = backgrounds;\n\n    this.background = this.parent.storage.background_index;\n  }\n\n  get backgrounds() {\n    return this.#backgrounds;\n  }\n\n  set background(index) {\n    if (index == null) {\n      index = this.random_background_index(this.backgrounds);\n    }\n\n    this.parent.storage.background_index = index;\n    this.#background_index = index;\n\n    this.update_background();\n  }\n\n  change() {\n    this.background = this.random_background_index(this.backgrounds);\n  }\n\n\n  random_background_index(arr){\n    return Math.floor(Math.random() * arr.length);\n  }\n\n  update_background () {\n    this.background_video_el.setAttribute(\"src\", this.backgrounds[this.#background_index].url);\n  }\n\n  setup() {\n    let that = this;\n    this.get_json(this.BACKGROUND_VIDEO_URL, (backgrounds) => {\n      that.backgrounds = backgrounds;\n    })\n  }\n}\n","export default class Shortcuts {\n  KEY_MAP = {\n    \"Space\": this.playpause,\n    \"ArrowRight\": this.next_station,\n    \"ArrowLeft\": this.prev_station,\n    \"ArrowDown\": this.change_background,\n    \"ArrowUp\": this.change_background\n  }\n\n  media;\n\n  constructor(parent) {\n    this.parent = parent;\n  }\n\n  setup() {\n    const that = this;\n    document.addEventListener(\"keyup\", (e) => {\n      e = e || window.event;\n\n      if (e.code in this.KEY_MAP) {\n        this.KEY_MAP[e.code].call(that, e)\n      }\n    })\n  }\n\n  playpause () {\n    this.parent.player.toggle();\n  }\n\n  next_station () {\n    this.parent.player.change_stream()\n    this.parent.player.start_stream()\n  }\n\n  prev_station () {\n    this.parent.player.change_stream()\n    this.parent.player.start_stream()\n  }\n\n  change_background () {\n    this.parent.background.change();\n  }\n}\n","export default class Info {\n\n    #stream_el;\n    #background_el;\n\n    constructor (parent) {\n      this.parent = parent;\n      this.info_el = parent.info_el;\n    }\n\n    get stream_el () {\n      if (!this.#stream_el) {\n        this.#stream_el = document.createElement(\"div\");\n        this.info_el.appendChild(this.#stream_el);\n      }\n      return this.#stream_el\n    }\n\n    get background_el () {\n      if (!this.#background_el) {\n        this.#background_el = document.createElement(\"div\");\n        this.info_el.appendChild(this.#background_el);\n      }\n      return this.#background_el\n    }\n\n    update_background(background) {\n      if (this.background_el.childNodes.length > 0) {\n        this.background_el.childNodes[0].remove()\n      }\n      let link = document.createElement(\"a\");\n      link.href = background.origin_url;\n      link.target = \"_blank\"\n      link.appendChild(document.createTextNode(background.title))\n      this.background_el.appendChild(link)\n    }\n\n    update_stream(stream) {\n      if (this.stream_el.childNodes.length > 0) {\n        this.stream_el.childNodes[0].remove()\n      }\n      let link = document.createElement(\"a\");\n      link.href = stream.origin_url;\n      link.target = \"_blank\"\n      link.appendChild(document.createTextNode(stream.title));\n      this.stream_el.appendChild(link)\n      this.parent.media.set_title(stream.title);\n    }\n}\n","export default class Media {\n\n  #metadata = {};\n\n  constructor(parent) {\n      this.parent = parent;\n  }\n\n  get media () {\n    if ('mediaSession' in navigator) {\n      return navigator.mediaSession;\n    }\n  }\n\n  set_metadata() {\n    this.media.metadata = new MediaMetadata(this.#metadata);\n  }\n\n  set_artist(artist) {\n    this.#metadata.artist = artist;\n    this.set_metadata()\n  }\n\n  set_title(title) {\n    this.#metadata.title = title;\n    this.set_metadata()\n  }\n\n  set_artwork(url) {\n    this.#metadata.artwork = [{src: url}];\n    this.set_metadata()\n  }\n\n  start() {\n    this.set_artwork(\"favicon.gif\");\n    this.media.setActionHandler('play', this.parent.player.toggle);\n    this.media.setActionHandler('pause', this.parent.player.toggle);\n    this.media.setActionHandler('stop', this.parent.player.toggle);\n    this.media.setActionHandler('seekbackward', this.parent.shortcuts.prev_station);\n    this.media.setActionHandler('seekforward', this.parent.shortcuts.next_station);\n    this.media.setActionHandler('previoustrack', this.parent.shortcuts.prev_station);\n    this.media.setActionHandler('nexttrack', this.parent.shortcuts.next_station);\n  }\n}\n","\nexport default class Gestures {\n\n  GESTURE_DELAY_MS = 200;\n\n  GESTURE_STATE = {\n    \"stopped\": 0,\n    \"started\": 1\n  }\n\n  #body_el;\n  #gesture_state = this.GESTURE_STATE.stopped;\n\n  constructor (parent) {\n    this.parent = parent;\n  }\n\n  get body_el() {\n    if (!this.#body_el) {\n      this.#body_el = document.body;\n    }\n    return this.#body_el;\n  }\n\n  start() {\n    this.body_el.addEventListener(\"touchstart\", this.touch_start.bind(this));\n    this.body_el.addEventListener(\"touchend\", this.touch_stop.bind(this));\n    this.body_el.addEventListener(\"touchcancel\", this.touch_stop.bind(this));\n  }\n\n  touch_start(e) {\n    this.#gesture_state = this.GESTURE_STATE.started;\n\n    setTimeout(this.timer_end.bind(this),this.GESTURE_DELAY_MS);\n  }\n\n  touch_stop(e) {\n    this.#gesture_state = this.GESTURE_STATE.stopped;\n  }\n\n  timer_end() {\n    if(this.#gesture_state == this.GESTURE_STATE.stopped) {\n      //tapped\n      this.parent.player.toggle();\n    }\n  }\n}\n","export default class Updater {\n  RELEASE_URL = \"release\"\n  RELESE_CHECK_SECONDS = 60 // low for testing\n\n  constructor (parent) {\n    this.parent = parent;\n\n    this.this_release = null;\n    this.check_loop = null;\n  }\n\n  get_release(url, callback) {\n    return fetch(url, {cache: \"no-cache\"})\n      .then(function(response) {\n        if (!response.ok) {\n          throw new Error(\"HTTP error, status = \" + response.status);\n        }\n        return response.text();\n      })\n      .then(callback.bind(this))\n  }\n\n  update_release(release) {\n    this.release = release;\n  }\n\n  start_check_loop() {\n    const delay = this.RELESE_CHECK_SECONDS * 1000 // in milliseconds\n\n    this.check_loop = setInterval(this.check_release.bind(this), delay);\n  }\n\n  check_release() {\n    let that = this;\n    this.get_release(this.RELEASE_URL, (latest_release) => {\n      if (latest_release != that.release) {\n        that.refresh_page()\n      }\n    })\n  }\n\n  refresh_page() {\n    window.location.reload();\n  }\n\n  start() {\n    this.get_release(this.RELEASE_URL, this.update_release)\n      .then(this.start_check_loop.bind(this));\n  }\n}\n","export default class Storage {\n    constructor (parent) {\n      this.parent = parent\n    }\n\n    get storage() {\n        return localStorage;\n    }\n\n    set_item(key, value) {\n        this.storage.setItem(key, value)\n    }\n\n    get_item(key, value) {\n        return this.storage.getItem(key)\n    }\n\n    get stream_index () {\n        return this.get_item(\"stream\")\n    }\n\n    set stream_index(index) {\n        this.set_item(\"stream\", index);\n    }\n\n    get background_index () {\n        return this.get_item(\"background\")\n    }\n\n    set background_index(index) {\n        this.set_item(\"background\", index);\n    }\n}","import StaticPlayer from \"./static.js\";\n\nlet static_player;\n\n(function () {\n  static_player = new StaticPlayer();\n  static_player.run();\n})();\n","import Player from \"./player.js\";\nimport Background from \"./background.js\";\nimport Shortcuts from \"./shortcuts.js\";\nimport Info from \"./info.js\";\nimport Media from \"./media.js\";\nimport Gestures from \"./gestures.js\";\nimport Updater from \"./updater.js\";\nimport Storage from \"./storage.js\";\n\n\nexport default class StaticPlayer {\n  BACKGROUND_VIDEO_EL_ID = \"background-video\"\n  BACKGROUND = Background;\n\n  PLAYER_EL_ID = \"player\";\n  PLAYER = Player;\n\n  SHORTCUTS = Shortcuts;\n\n  INFO_EL_ID = \"info\";\n  INFO = Info;\n\n  MEDIA = Media;\n\n  GESTURES = Gestures;\n\n  UPDATER = Updater;\n\n  STORAGE = Storage;\n\n  #background_video;\n  #background;\n  #player_el;\n  #player;\n  #shortcuts;\n  #info_el;\n  #info;\n  #media;\n  #gestures;\n  #updater;\n  #storage;\n\n\n  get background_video_el (){\n    if (!this.#background_video){\n      this.#background_video = document.getElementById(this.BACKGROUND_VIDEO_EL_ID);\n    }\n    return this.#background_video;\n  }\n\n  get background() {\n    if (!this.#background) {\n      this.#background = new this.BACKGROUND(this);\n    }\n    return this.#background;\n  }\n\n  get player_el (){\n    if (!this.#player_el) {\n      this.#player_el = document.getElementById(this.PLAYER_EL_ID);\n    }\n    return this.#player_el;\n  }\n\n  get player(){\n    if(!this.#player) {\n      this.#player = new this.PLAYER(this);\n    }\n    return this.#player;\n  }\n\n  get shortcuts() {\n    if (!this.#shortcuts) {\n      this.#shortcuts = new this.SHORTCUTS(this);\n    }\n    return this.#shortcuts;\n  }\n\n  get info_el (){\n    if (!this.#info_el) {\n      this.#info_el = document.getElementById(this.INFO_EL_ID);\n    }\n    return this.#info_el;\n  }\n\n  get info(){\n    if(!this.#info) {\n      this.#info = new this.INFO(this);\n    }\n    return this.#info;\n  }\n\n  get media () {\n    if(!this.#media) {\n      this.#media = new this.MEDIA(this);\n    }\n    return this.#media;\n  }\n\n  get gestures () {\n    if(!this.#gestures) {\n      this.#gestures = new this.GESTURES(this);\n    }\n    return this.#gestures;\n  }\n\n  get updater () {\n    if(!this.#updater) {\n      this.#updater = new this.UPDATER(this);\n    }\n    return this.#updater;\n  }\n\n  get storage () {\n    if(!this.#storage) {\n      this.#storage = new this.STORAGE(this);\n    }\n    return this.#storage;\n  }\n\n  run() {\n    this.shortcuts.setup();\n    this.player.setup();\n    this.background.setup();\n    this.media.start();\n    this.gestures.start();\n    this.updater.start();\n  }\n}\n"],"names":["YouTube","constructor","parent","this","player_el","stream_url","stream","url","setup","that","document","createElement","setAttribute","addEventListener","e","play","appendChild","state","post_message","message","contentWindow","postMessage","stop","destroy","remove","undefined","Player","STREAMS_URL","SOURCES","get_json","callback","fetch","then","response","ok","Error","status","json","bind","streams","storage","stream_index","index","random_stream_index","start_stream","arr","Math","floor","random","length","random_stream","Object","keys","map","key","random_choice","change_stream","step","next","info","update_stream","source","URL","hostname","pause","toggle","clear","BackgroundVideo","BACKGROUND_VIDEO_URL","background_video_el","defaultPlaybackRate","backgrounds","background","background_index","random_background_index","update_background","change","Shortcuts","KEY_MAP","playpause","next_station","prev_station","change_background","media","window","event","code","call","player","Info","info_el","stream_el","background_el","childNodes","link","href","origin_url","target","createTextNode","title","set_title","Media","navigator","mediaSession","set_metadata","metadata","MediaMetadata","set_artist","artist","set_artwork","artwork","src","start","setActionHandler","shortcuts","Gestures","GESTURE_DELAY_MS","GESTURE_STATE","stopped","body_el","body","touch_start","touch_stop","started","setTimeout","timer_end","Updater","RELEASE_URL","RELESE_CHECK_SECONDS","this_release","check_loop","get_release","cache","text","update_release","release","start_check_loop","delay","setInterval","check_release","latest_release","refresh_page","location","reload","Storage","localStorage","set_item","value","setItem","get_item","getItem","static_player","BACKGROUND_VIDEO_EL_ID","BACKGROUND","PLAYER_EL_ID","PLAYER","SHORTCUTS","INFO_EL_ID","INFO","MEDIA","GESTURES","UPDATER","STORAGE","getElementById","gestures","updater","run"],"sourceRoot":""}