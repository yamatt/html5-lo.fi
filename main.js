(()=>{"use strict";class t{#t;#e;constructor(t){this.parent=t,this.player_el=t.player_el,this.stream_url=t.stream.url}setup(){let t=this;this.#e=document.createElement("iframe"),this.#e.setAttribute("allow","autoplay; encrypted-media;"),this.#e.setAttribute("src",this.stream_url+"?enablejsapi=1"),this.#e.addEventListener("load",(function(e){t.play()})),this.player_el.appendChild(this.#e),this.state=0}get state(){return this.#t}set state(t){this.#t=t}post_message(t){this.#e.contentWindow.postMessage('{"event":"command","func":"'+t+'","args":""}',"*")}play(){this.post_message("playVideo"),this.state=1}stop(){this.post_message("stopVideo"),this.state=0}destroy(){this.stop(),this.#e.remove(),this.#e=void 0,this.state}}class e{STREAMS_URL="streams.json";SOURCES={"www.youtube.com":t};#s;#r;constructor(t){this.parent=t,this.player_el=t.player_el}get_json(t,e){return fetch(t).then((function(t){if(!t.ok)throw new Error("HTTP error, status = "+t.status);return t.json()})).then(e.bind(this))}set streams(t){this.#s=t,this.stream=this.parent.storage.stream_index}get streams(){return this.#s}set stream(t){null==t&&(t=this.random_stream_index(this.streams)),this.parent.storage.stream_index=t,this.#r=t,this.start_stream()}get stream(){return this.streams[this.#r]}random_stream_index(t){return Math.floor(Math.random()*t.length)}random_stream(){var t=this;let e=Object.keys(this.streams).map((function(e){return t.streams[e]}));return this.random_choice(e)}change_stream(t){t||(t=1);let e=this.#r+t;e>this.streams.length-1&&(e=0),this.stream=e}start_stream(){this.parent.info.update_stream(this.stream),this.source&&this.source.destroy();const t=new URL(this.stream.url);this.source=new this.SOURCES[t.hostname](this),this.source.setup()}pause(){this.source.stop()}play(){this.source.play()}toggle(){1!=this.source.state?0!=this.source.state||this.source.play():this.source.stop()}clear(){this.source&&this.source.destroy()}setup(){let t=this;this.get_json(this.STREAMS_URL,(e=>{t.streams=e}))}}class s{BACKGROUND_VIDEO_URL="backgrounds.json";#a;#i;constructor(t){this.parent=t,this.background_video_el=t.background_video_el,this.background_video_el.defaultPlaybackRate=.5}get_json(t,e){return fetch(t).then((function(t){if(!t.ok)throw new Error("HTTP error, status = "+t.status);return t.json()})).then(e.bind(this))}set backgrounds(t){this.#a=t,this.background=this.parent.storage.background_index}get backgrounds(){return this.#a}set background(t){null==t&&(t=this.random_background_index(this.backgrounds)),this.parent.storage.background_index=t,this.#i=t,this.update_background()}change(){this.background=this.random_background_index(this.backgrounds)}random_background_index(t){return Math.floor(Math.random()*t.length)}update_background(){this.background_video_el.setAttribute("src",this.backgrounds[this.#i].url)}setup(){let t=this;this.get_json(this.BACKGROUND_VIDEO_URL,(e=>{t.backgrounds=e}))}}class r{KEY_MAP={Space:this.playpause,ArrowRight:this.next_station,ArrowLeft:this.prev_station,ArrowDown:this.change_background,ArrowUp:this.change_background};media;constructor(t){this.parent=t}setup(){const t=this;document.addEventListener("keyup",(e=>{(e=e||window.event).code in this.KEY_MAP&&this.KEY_MAP[e.code].call(t,e)}))}playpause(){this.parent.player.toggle()}next_station(){this.parent.player.change_stream(),this.parent.player.start_stream()}prev_station(){this.parent.player.change_stream(),this.parent.player.start_stream()}change_background(){this.parent.background.change()}}class a{#n;#h;constructor(t){this.parent=t,this.info_el=t.info_el}get stream_el(){return this.#n||(this.#n=document.createElement("div"),this.info_el.appendChild(this.#n)),this.#n}get background_el(){return this.#h||(this.#h=document.createElement("div"),this.info_el.appendChild(this.#h)),this.#h}update_background(t){this.background_el.childNodes.length>0&&this.background_el.childNodes[0].remove();let e=document.createElement("a");e.href=t.origin_url,e.target="_blank",e.appendChild(document.createTextNode(t.title)),this.background_el.appendChild(e)}update_stream(t){this.stream_el.childNodes.length>0&&this.stream_el.childNodes[0].remove();let e=document.createElement("a");e.href=t.origin_url,e.target="_blank",e.appendChild(document.createTextNode(t.title)),this.stream_el.appendChild(e),this.parent.media.set_title(t.title)}}class i{#o={};constructor(t){this.parent=t}get media(){if("mediaSession"in navigator)return navigator.mediaSession}set_metadata(){this.media.metadata=new MediaMetadata(this.#o)}set_artist(t){this.#o.artist=t,this.set_metadata()}set_title(t){this.#o.title=t,this.set_metadata()}set_artwork(t){this.#o.artwork=[{src:t}],this.set_metadata()}start(){this.set_artwork("favicon.gif"),this.media.setActionHandler("play",this.parent.player.toggle),this.media.setActionHandler("pause",this.parent.player.toggle),this.media.setActionHandler("stop",this.parent.player.toggle),this.media.setActionHandler("seekbackward",this.parent.shortcuts.prev_station),this.media.setActionHandler("seekforward",this.parent.shortcuts.next_station),this.media.setActionHandler("previoustrack",this.parent.shortcuts.prev_station),this.media.setActionHandler("nexttrack",this.parent.shortcuts.next_station)}}class n{GESTURE_DELAY_MS=200;GESTURE_STATE={stopped:0,started:1};#d;#u=this.GESTURE_STATE.stopped;constructor(t){this.parent=t}get body_el(){return this.#d||(this.#d=document.body),this.#d}start(){this.body_el.addEventListener("touchstart",this.touch_start.bind(this)),this.body_el.addEventListener("touchend",this.touch_stop.bind(this)),this.body_el.addEventListener("touchcancel",this.touch_stop.bind(this))}touch_start(t){this.#u=this.GESTURE_STATE.started,setTimeout(this.timer_end.bind(this),this.GESTURE_DELAY_MS)}touch_stop(t){this.#u=this.GESTURE_STATE.stopped}timer_end(){this.#u==this.GESTURE_STATE.stopped&&this.parent.player.toggle()}}class h{RELEASE_URL="release";RELESE_CHECK_SECONDS=60;constructor(t){this.parent=t,this.this_release=null,this.check_loop=null}get_release(t,e){return fetch(t,{cache:"no-cache"}).then((function(t){if(!t.ok)throw new Error("HTTP error, status = "+t.status);return t.text()})).then(e.bind(this))}update_release(t){this.release=t}start_check_loop(){const t=1e3*this.RELESE_CHECK_SECONDS;this.check_loop=setInterval(this.check_release.bind(this),t)}check_release(){let t=this;this.get_release(this.RELEASE_URL,(e=>{e!=t.release&&t.refresh_page()}))}refresh_page(){window.location.reload()}start(){this.get_release(this.RELEASE_URL,this.update_release).then(this.start_check_loop.bind(this))}}class o{constructor(t){this.parent=t}get storage(){return localStorage}set_item(t,e){this.storage.setItem(t,e)}get_item(t,e){return this.storage.getItem(t)}get stream_index(){return this.get_item("stream")}set stream_index(t){this.set_item("stream",t)}get background_index(){return this.get_item("background")}set background_index(t){this.set_item("background",t)}}let d;d=new class{BACKGROUND_VIDEO_EL_ID="background-video";BACKGROUND=s;PLAYER_EL_ID="player";PLAYER=e;SHORTCUTS=r;INFO_EL_ID="info";INFO=a;MEDIA=i;GESTURES=n;UPDATER=h;STORAGE=o;#c;#_;#l;#g;#m;#p;#E;#b;#k;#y;#f;get background_video_el(){return this.#c||(this.#c=document.getElementById(this.BACKGROUND_VIDEO_EL_ID)),this.#c}get background(){return this.#_||(this.#_=new this.BACKGROUND(this)),this.#_}get player_el(){return this.#l||(this.#l=document.getElementById(this.PLAYER_EL_ID)),this.#l}get player(){return this.#g||(this.#g=new this.PLAYER(this)),this.#g}get shortcuts(){return this.#m||(this.#m=new this.SHORTCUTS(this)),this.#m}get info_el(){return this.#p||(this.#p=document.getElementById(this.INFO_EL_ID)),this.#p}get info(){return this.#E||(this.#E=new this.INFO(this)),this.#E}get media(){return this.#b||(this.#b=new this.MEDIA(this)),this.#b}get gestures(){return this.#k||(this.#k=new this.GESTURES(this)),this.#k}get updater(){return this.#y||(this.#y=new this.UPDATER(this)),this.#y}get storage(){return this.#f||(this.#f=new this.STORAGE(this)),this.#f}run(){this.shortcuts.setup(),this.player.setup(),this.background.setup(),this.media.start(),this.gestures.start(),this.updater.start()}},d.run()})();
//# sourceMappingURL=main.js.map