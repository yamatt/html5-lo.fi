(()=>{"use strict";class t{STOPPED=0;PLAYING=1}class e{constructor(t,e){this.player_el=t}setup(){var e=document.createElement("iframe");e.setAttribute("allow","autoplay; encrypted-media;"),e.setAttribute("src",stream.url+"?enablejsapi=1"),this.player_el.appendChild(e),this.state=t.STOPPED}post_message(t){this.player_el.childNodes[0].contentWindow.postMessage('{"event":"command","func":"'+t+'","args":""}',"*")}play(){this.state==t.STOPPED&&(this.post_message("playVideo"),this.state=t.PLAYING)}stop(){this.state==t.PLAYING&&(this.post_message("stopVideo"),this.state=t.STOPPED)}toggle(){this.state!=t.PLAYING?this.state!=t.STOPPED||this.play():this.stop()}destroy(){for(this.stop();this.player_el.lastChild;)this.player_el.removeChild(this.player_el.lastChild);this.state}}class s{STREAMS_URL="streams.json";STREAMERS={"www.youtube.com":e};constructor(t){this.player_el=t}get_json(t,e){fetch(t).then((function(t){if(!t.ok)throw new Error("HTTP error, status = "+t.status);return t.json()})).then(e).catch((function(t){console.log(t.message)}))}handle_streams(t){this.update_stream(this.random_choice(t))}random_choice(t){return t[Math.floor(Math.random()*t.length)]}update_stream(t){this.streamer&&this.streamer.destroy();const e=new URL(t.url);this.streamer=this.STREAMERS[e.hostname](this.player_el,t.url),this.streamer.setup()}pause(){this.streamer.stop()}play(){this.streamer.play()}toggle(){this.streamer.toggle()}clear(){this.streamer&&this.streamer.destroy()}start(){this.get_json(this.STREAMS_URL,this.handle_streams)}}class r{BACKGROUND_VIDEO_URL="backgrounds.json";constructor(t){this.background_video_el=t,this.background_video_el.defaultPlaybackRate=.5}get_json(t,e){fetch(t).then((function(t){if(!t.ok)throw new Error("HTTP error, status = "+t.status);return t.json()})).then(e.bind(this)).catch((function(t){console.log(t.message)}))}handle_backgrounds(t){this.update_video(this.random_choice(t))}random_choice(t){return t[Math.floor(Math.random()*t.length)]}update_video(t){this.background_video_el.setAttribute("src",t.url)}start(){this.get_json(this.BACKGROUND_VIDEO_URL,this.handle_backgrounds)}}class a{KEY_MAP={Space:this.space};constructor(t,e){this.background=t,this.player=e}setup(){document.addEventListener("keypress",(t=>{t=t||window.event,this.KEY_MAP[t.code](t)}))}space(t){this.player.toggle()}}(new class{PLAYER_EL_ID="player";BACKGROUND_VIDEO_EL_ID="background-video";#background_video;#background;#player_el;#player;#shortcuts;get background_video_el(){return this.#background_video||(this.#background_video=document.getElementById(this.BACKGROUND_VIDEO_EL_ID)),this.#background_video}get background(){return this.#background||(this.#background=new r(this.background_video_el)),this.#background}get player_el(){return this.#player_el||(this.#player_el=document.getElementById(this.PLAYER_EL_ID)),this.#player_el}get player(){return this.#player||(this.#player=new s(this.player_el)),this.#player}get shortcuts(){return this.#shortcuts||(this.#shortcuts=new a(this.background,this.player)),this.#shortcuts}run(){this.shortcuts.setup(),this.player.start(),this.background.start()}}).run()})();
//# sourceMappingURL=main.js.map